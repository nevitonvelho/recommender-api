<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Produto e Recomendados</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .product, .recommendation {
      border: 1px solid #ddd;
      padding: 15px;
      margin-bottom: 20px;
      border-radius: 8px;
      display: flex;
      align-items: center;
      gap: 15px;
    }
    img {
      width: 120px;
      height: auto;
      border-radius: 6px;
    }
    .title {
      font-size: 18px;
      font-weight: bold;
    }
  </style>
</head>
<body>

  <h1>Produto</h1>
  <div id="product"></div>

  <h2>Recomendações</h2>
  <div id="recommendations"></div>

  <script>
    const apiBase = 'http://localhost:5000';

    const params = new URLSearchParams(window.location.search);
    const productId = params.get('product_id');

    const productEl = document.getElementById('product');
    const recsEl = document.getElementById('recommendations');

    if (!productId) {
      productEl.innerHTML = '<p>Erro: nenhum product_id fornecido na URL.</p>';
    } else {
      fetch(`${apiBase}/products`)
        .then(res => res.json())
        .then(data => {
          const produto = data.find(p => p.product_id === productId);
          if (!produto) {
            productEl.innerHTML = '<p>Produto não encontrado.</p>';
            return;
          }

          productEl.innerHTML = `
            <div class="product">
              <img src="${produto.img_url}" alt="${produto.product_name}">
              <div>
                <div class="title">${produto.product_name}</div>
                <p>${produto.description}</p>
                <strong>Preço: R$ ${produto.preco.toFixed(2)}</strong>
              </div>
            </div>
          `;

          fetch(`${apiBase}/recommend?product_id=${productId}`)
            .then(res => res.json())
            .then(recs => {
              if (recs.error) {
                recsEl.innerHTML = `<p>${recs.error}</p>`;
              } else {
                recs.forEach(rec => {
                  const recData = data.find(p => p.product_id === rec.product_id);
                  if (recData) {
                    recsEl.innerHTML += `
                      <div class="recommendation">
                        <img src="${recData.img_url}" alt="${recData.product_name}">
                        <div>
                          <div class="title">${recData.product_name}</div>
                          <p>${recData.description}</p>
                          <strong>Preço: R$ ${recData.preco.toFixed(2)}</strong><br>
                          <a href="?product_id=${recData.product_id}">Ver produto</a>
                        </div>
                      </div>
                    `;
                  }
                });
              }
            });
        });
    }
  </script>

</body>
</html>
